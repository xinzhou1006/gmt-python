


<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
    
        <title>Design &mdash; GMT/Python</title>
    


  
  
    <link rel="shortcut icon" href="_static/favicon.png"/>
  
  
  

  

  
  
    

  

  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="_static/style.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="prev" title="Sphinx Extension" href="sphinxext.html" />
    
    <script src="_static/require.js"></script>


  
  <script src="_static/js/modernizr.min.js"></script>

</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search">
          
    <a href="index.html"><h2 class="sidebar-title">GMT/Python</h2></a>

    
        
        
            <div class="version">
                dev
            </div>
        
    

    
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>


        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
    
            
            
              
            
            
              <p class="caption"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="install.html">Installing</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorials/first-steps.html">First Steps with GMT/Python</a></li>
</ul>
<p class="caption"><span class="caption-text">User Guide</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="tutorials/plot-data-points.html">Plotting data points</a></li>
<li class="toctree-l1"><a class="reference internal" href="api/index.html">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="sphinxext.html">Sphinx Extension</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">Design</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#previous-work">Previous work</a></li>
<li class="toctree-l2"><a class="reference internal" href="#about-modern-mode">About modern mode</a></li>
<li class="toctree-l2"><a class="reference internal" href="#gmt-python">GMT Python</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-gmt-python-api">The GMT Python API</a></li>
<li class="toctree-l2"><a class="reference internal" href="#package-organization">Package organization</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-module-functions">The module functions</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-low-level-wrappers">The low-level wrappers</a></li>
</ul>
</li>
</ul>

            
          

    
        <p class="caption">
            <span class="caption-text">External links</span>
        </p>
        <ul>
            
                <li class="toctree-l1"><a href="http://try.gmtpython.xyz"><i class="fa fa-play fa-fw"></i> Try it online!</a></li>
            
                <li class="toctree-l1"><a href="https://github.com/GenericMappingTools/gmt-python"><i class="fa fa-github fa-fw"></i> Source Code</a></li>
            
                <li class="toctree-l1"><a href="https://github.com/GenericMappingTools/gmt-python/blob/master/CONTRIBUTING.md"><i class="fa fa-users fa-fw"></i> Contributing</a></li>
            
                <li class="toctree-l1"><a href="https://github.com/GenericMappingTools/gmt-python/blob/master/CODE_OF_CONDUCT.md"><i class="fa fa-book fa-fw"></i> Code of Conduct</a></li>
            
                <li class="toctree-l1"><a href="https://github.com/GenericMappingTools/gmt-python/blob/master/LICENSE.txt"><i class="fa fa-gavel fa-fw"></i> License</a></li>
            
                <li class="toctree-l1"><a href="https://gitter.im/GenericMappingTools/gmt-python"><i class="fa fa-comment fa-fw"></i> Contact</a></li>
            
        </ul>
    

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">GMT/Python</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          
















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>Design</li>
    
    
    <li class="source-link">
        
            
                <a href="https://github.com/GenericMappingTools/gmt-python/edit/master/doc/design.rst"
                   class="fa fa-github"> Improve this page</a>
            
        
        
    </li>

  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  
<style>
/* CSS overrides for sphinx_rtd_theme */

/* 24px margin */
.nbinput.nblast,
.nboutput.nblast {
    margin-bottom: 19px;  /* padding has already 5px */
}

/* ... except between code cells! */
.nblast + .nbinput {
    margin-top: -19px;
}

.admonition > p:before {
    margin-right: 4px;  /* make room for the exclamation icon */
}
</style>
<div class="section" id="design">
<span id="id1"></span><h1>Design<a class="headerlink" href="#design" title="Permalink to this headline">¶</a></h1>
<div class="section" id="previous-work">
<h2>Previous work<a class="headerlink" href="#previous-work" title="Permalink to this headline">¶</a></h2>
<p>To my knowledge, there have been 3 attempts at a GMT Python interface:</p>
<ul class="simple">
<li><a class="reference external" href="https://github.com/emolch/gmtpy">gmtpy</a> by
<a class="reference external" href="https://github.com/emolch">Sebastian Heimann</a></li>
<li><a class="reference external" href="https://github.com/ian-r-rose/pygmt">pygmt</a> by
<a class="reference external" href="https://github.com/ian-r-rose">Ian Rose</a></li>
<li><a class="reference external" href="https://github.com/glimmer-cism/PyGMT">PyGMT</a>  by
<a class="reference external" href="https://github.com/mhagdorn">Magnus Hagdorn</a></li>
</ul>
<p>Only <code class="docutils literal notranslate"><span class="pre">gmtpy</span></code> has received commits since 2014 and is the more mature
alternative.
However, the project <a class="reference external" href="https://github.com/emolch/gmtpy/graphs/contributors">doesn’t seem to be very activate</a>.
Both <code class="docutils literal notranslate"><span class="pre">gmtpy</span></code> and <code class="docutils literal notranslate"><span class="pre">PyGMT</span></code> use system class (through <code class="docutils literal notranslate"><span class="pre">subprocess.Popen</span></code>)
and pass input and output through <code class="docutils literal notranslate"><span class="pre">subprocess.PIPE</span></code>.
<code class="docutils literal notranslate"><span class="pre">pygmt</span></code> seems to call the GMT C API directly through a hand-coded Python C
extension.
This might compromise the portability of the package across operating systems
and makes distribution very painful.</p>
<p>We aim to learn from these attempts and create a library that interfaces with
the C API and provides a Pythonic API for GMT.</p>
</div>
<div class="section" id="about-modern-mode">
<h2>About modern mode<a class="headerlink" href="#about-modern-mode" title="Permalink to this headline">¶</a></h2>
<p>GMT is introducing a “modern” execution mode that reduces the amount of
arguments needed for many programs and handles the PostScript building in the
background. <code class="docutils literal notranslate"><span class="pre">gmt-python</span></code> will be based strongly on modern mode but will also
allow the classic syntax.</p>
<p>For example, the following classic mode script that creates a PDF map:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Shading grid and color pallete</span>
<span class="n">gmt</span> <span class="n">grdgradient</span> <span class="o">-</span><span class="n">Nt0</span><span class="o">.</span><span class="mi">2</span> <span class="o">-</span><span class="n">A45</span> <span class="n">data</span><span class="o">.</span><span class="n">nc</span> <span class="o">-</span><span class="n">Gintens</span><span class="o">.</span><span class="n">nc</span>
<span class="n">gmt</span> <span class="n">makecpt</span> <span class="o">-</span><span class="n">Cgeo</span> <span class="o">-</span><span class="n">T</span><span class="o">-</span><span class="mi">8000</span><span class="o">/</span><span class="mi">2000</span> <span class="o">&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">cpt</span>
<span class="c1"># Build the map, one layer at a time</span>
<span class="n">gmt</span> <span class="n">grdimage</span> <span class="o">-</span><span class="n">Ct</span><span class="o">.</span><span class="n">cpt</span> <span class="o">-</span><span class="n">Iintens</span><span class="o">.</span><span class="n">nc</span> <span class="n">data</span><span class="o">.</span><span class="n">nc</span> <span class="o">-</span><span class="n">JM6i</span> <span class="o">-</span><span class="n">P</span> <span class="o">-</span><span class="n">K</span> <span class="o">&gt;</span> <span class="nb">map</span><span class="o">.</span><span class="n">ps</span>
<span class="n">gmt</span> <span class="n">pscoast</span> <span class="o">-</span><span class="n">Rdata</span><span class="o">.</span><span class="n">nc</span> <span class="o">-</span><span class="n">J</span> <span class="o">-</span><span class="n">O</span> <span class="o">-</span><span class="n">Dh</span> <span class="o">-</span><span class="n">Baf</span> <span class="o">-</span><span class="n">W0</span><span class="o">.</span><span class="mi">75</span><span class="n">p</span> <span class="o">-</span><span class="n">K</span> <span class="o">&gt;&gt;</span> <span class="nb">map</span><span class="o">.</span><span class="n">ps</span>
<span class="n">echo</span> <span class="s2">&quot;Japan Trench&quot;</span> <span class="o">|</span> <span class="n">gmt</span> <span class="n">pstext</span> <span class="o">-</span><span class="n">F</span><span class="o">+</span><span class="n">f32p</span><span class="o">+</span><span class="n">cTC</span> <span class="o">-</span><span class="n">Dj0</span><span class="o">/</span><span class="mf">0.2</span><span class="n">i</span> <span class="o">-</span><span class="n">Gwhite</span> <span class="o">-</span><span class="n">R</span> <span class="o">-</span><span class="n">J</span> <span class="o">-</span><span class="n">O</span> <span class="o">-</span><span class="n">K</span> <span class="o">&gt;&gt;</span> <span class="nb">map</span><span class="o">.</span><span class="n">ps</span>
<span class="n">gmt</span> <span class="n">psxy</span> <span class="o">-</span><span class="n">W2p</span> <span class="n">lines</span><span class="o">.</span><span class="n">txt</span> <span class="o">-</span><span class="n">R</span> <span class="o">-</span><span class="n">J</span> <span class="o">-</span><span class="n">O</span> <span class="o">-</span><span class="n">K</span> <span class="o">&gt;&gt;</span> <span class="nb">map</span><span class="o">.</span><span class="n">ps</span>
<span class="n">gmt</span> <span class="n">psscale</span> <span class="o">-</span><span class="n">R</span> <span class="o">-</span><span class="n">J</span> <span class="o">-</span><span class="n">O</span> <span class="o">-</span><span class="n">DjBL</span><span class="o">+</span><span class="n">w3i</span><span class="o">/</span><span class="mf">0.1</span><span class="n">i</span><span class="o">+</span><span class="n">h</span><span class="o">+</span><span class="n">o0</span><span class="o">.</span><span class="mi">3</span><span class="n">i</span><span class="o">/</span><span class="mf">0.4</span><span class="n">i</span> <span class="o">-</span><span class="n">Ct</span><span class="o">.</span><span class="n">cpt</span> <span class="o">-</span><span class="n">W0</span><span class="o">.</span><span class="mi">001</span> <span class="o">-</span><span class="n">F</span><span class="o">+</span><span class="n">gwhite</span><span class="o">+</span><span class="n">p0</span><span class="o">.</span><span class="mi">5</span><span class="n">p</span> <span class="o">-</span><span class="n">Bxaf</span> <span class="o">-</span><span class="n">By</span><span class="o">+</span><span class="n">l</span><span class="s2">&quot;km&quot;</span> <span class="o">&gt;&gt;</span> <span class="nb">map</span><span class="o">.</span><span class="n">ps</span>
<span class="c1"># Convert the PostScript map to PDF</span>
<span class="n">gmt</span> <span class="n">psconvert</span> <span class="n">maps</span><span class="o">.</span><span class="n">ps</span> <span class="o">-</span><span class="n">Tf</span>
</pre></div>
</div>
<p>is equivalent to the following in modern mode:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Start a new session named &quot;map&quot; that will produce PDF output</span>
<span class="n">gmt</span> <span class="n">begin</span> <span class="nb">map</span> <span class="n">pdf</span>
    <span class="c1"># Same thing but no redirecting and -R -J -O -K</span>
    <span class="n">gmt</span> <span class="n">grdgradient</span> <span class="o">-</span><span class="n">Nt0</span><span class="o">.</span><span class="mi">2</span> <span class="o">-</span><span class="n">A45</span> <span class="n">data</span><span class="o">.</span><span class="n">nc</span> <span class="o">-</span><span class="n">Gintens</span><span class="o">.</span><span class="n">nc</span>
    <span class="n">gmt</span> <span class="n">makecpt</span> <span class="o">-</span><span class="n">Cgeo</span> <span class="o">-</span><span class="n">T</span><span class="o">-</span><span class="mi">8000</span><span class="o">/</span><span class="mi">2000</span> <span class="o">&gt;</span> <span class="n">t</span><span class="o">.</span><span class="n">cpt</span>
    <span class="n">gmt</span> <span class="n">grdimage</span> <span class="o">-</span><span class="n">Ct</span><span class="o">.</span><span class="n">cpt</span> <span class="o">-</span><span class="n">Iintens</span><span class="o">.</span><span class="n">nc</span> <span class="n">data</span><span class="o">.</span><span class="n">nc</span> <span class="o">-</span><span class="n">JM6i</span>
    <span class="n">gmt</span> <span class="n">coast</span> <span class="o">-</span><span class="n">Rdata</span><span class="o">.</span><span class="n">nc</span> <span class="o">-</span><span class="n">Dh</span> <span class="o">-</span><span class="n">Baf</span> <span class="o">-</span><span class="n">W0</span><span class="o">.</span><span class="mi">75</span><span class="n">p</span>
    <span class="n">echo</span> <span class="s2">&quot;Japan Trench&quot;</span> <span class="o">|</span> <span class="n">gmt</span> <span class="n">text</span> <span class="o">-</span><span class="n">F</span><span class="o">+</span><span class="n">f32p</span><span class="o">+</span><span class="n">cTC</span> <span class="o">-</span><span class="n">Dj0</span><span class="o">/</span><span class="mf">0.2</span><span class="n">i</span> <span class="o">-</span><span class="n">Gwhite</span>
    <span class="n">gmt</span> <span class="n">plot</span> <span class="o">-</span><span class="n">W2p</span> <span class="n">lines</span><span class="o">.</span><span class="n">txt</span>
    <span class="n">gmt</span> <span class="n">colorbar</span> <span class="o">-</span><span class="n">DjBL</span><span class="o">+</span><span class="n">w3i</span><span class="o">/</span><span class="mf">0.1</span><span class="n">i</span><span class="o">+</span><span class="n">h</span><span class="o">+</span><span class="n">o0</span><span class="o">.</span><span class="mi">3</span><span class="n">i</span><span class="o">/</span><span class="mf">0.4</span><span class="n">i</span> <span class="o">-</span><span class="n">Ct</span><span class="o">.</span><span class="n">cpt</span> <span class="o">-</span><span class="n">W0</span><span class="o">.</span><span class="mi">001</span> <span class="o">-</span><span class="n">F</span><span class="o">+</span><span class="n">gwhite</span><span class="o">+</span><span class="n">p0</span><span class="o">.</span><span class="mi">5</span><span class="n">p</span> <span class="o">-</span><span class="n">Bxaf</span> <span class="o">-</span><span class="n">By</span><span class="o">+</span><span class="n">l</span><span class="s2">&quot;km&quot;</span>
<span class="c1"># When a session ends, GMT will fetch the map it produced and convert it to</span>
<span class="c1"># PDF automatically. The file will be named after the session &quot;map.pdf&quot;</span>
<span class="n">gmt</span> <span class="n">end</span>
</pre></div>
</div>
<p>This is a great improvement: the code is smaller and more readable. It fits
naturally with Python <a class="reference external" href="https://docs.python.org/3/reference/datamodel.html#context-managers" title="(in Python v3.7)"><span class="xref std std-ref">context managers</span></a> and can
be used to embed PNG converted output into Jupyter notebooks when <code class="docutils literal notranslate"><span class="pre">gmt</span> <span class="pre">end</span></code>
is called.</p>
<p>Read more about modern mode at the
<a class="reference external" href="http://gmt.soest.hawaii.edu/projects/gmt/wiki/Modernization">Modernization wiki page</a>.</p>
</div>
<div class="section" id="gmt-python">
<h2>GMT Python<a class="headerlink" href="#gmt-python" title="Permalink to this headline">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">gmt-python</span></code> is made for the future. We will support <strong>only Python 3.5 or
later</strong> and require the <a class="reference external" href="http://gmt.soest.hawaii.edu/boards/2/topics/4930">new “modern” mode of GMT</a>
(currently only in the <code class="docutils literal notranslate"><span class="pre">trunk</span></code> of the SVN repository).
The <code class="docutils literal notranslate"><span class="pre">modern</span></code> mode removes the need for <code class="docutils literal notranslate"><span class="pre">-O</span> <span class="pre">-K</span></code> and explicitly redirecting
to a <code class="docutils literal notranslate"><span class="pre">.ps</span></code> file.
This all happens in the background.
A final call to <code class="docutils literal notranslate"><span class="pre">gmt</span> <span class="pre">end</span></code> brings the plot out of hiding and finalizes
the Postscript.
This mode is perfect for the Python interface, which would have to handle
generation of the Postscript file in the background anyway.</p>
<p>We will wrap the GMT C API using the <a class="reference external" href="https://docs.python.org/3/library/ctypes.html#module-ctypes" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ctypes</span></code></a> module of the Python
standard library.
<a class="reference external" href="https://docs.python.org/3/library/ctypes.html#module-ctypes" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ctypes</span></code></a> grants access to C data types and foreign functions in DDLs and
shared libraries, making it possible to wrap these libraries with pure Python
code.
Not having compiled modules makes packaging and distribution of Python software
a lot easier.</p>
<p>Wrappers for GMT data types and C functions will be implemented in a lower
level wrapper library.
These will be direct <a class="reference external" href="https://docs.python.org/3/library/ctypes.html#module-ctypes" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ctypes</span></code></a> wrappers of the GMT module functions and any
other function that is needed on the Python side.
The low-level functions will not handle any data type conversion or setting up
of argument list.</p>
<p>We’ll also provide higher level functions that mirror all GMT modules.
These functions will be built on top of the low-level library and will handle
all data conversions and parsing of arguments.
This is the part of the library with which the user will interact (the GMT
Python API).</p>
</div>
<div class="section" id="the-gmt-python-api">
<h2>The GMT Python API<a class="headerlink" href="#the-gmt-python-api" title="Permalink to this headline">¶</a></h2>
<p>Each GMT module has a function in the <code class="docutils literal notranslate"><span class="pre">gmt</span></code> package.
Command-line arguments are passes as function keyword arguments.
Data can be passed as file names or in-memory data.</p>
<p>The simplest usage would be with data in a file and generating a PDF output
figure, just as a normal GMT script:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gmt</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">gmt</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<span class="n">cpt</span> <span class="o">=</span> <span class="n">gmt</span><span class="o">.</span><span class="n">makecpt</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="s1">&#39;cubhelix&#39;</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="p">[</span><span class="o">-</span><span class="mi">4500</span><span class="p">,</span> <span class="mi">4500</span><span class="p">])</span>
<span class="n">fig</span><span class="o">.</span><span class="n">grdimage</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="s1">&#39;grid.nc&#39;</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="s1">&#39;M6i&#39;</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="s1">&#39;af&#39;</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">cpt</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="n">cpt</span><span class="p">,</span> <span class="n">D</span><span class="o">=</span><span class="s1">&#39;jTC+w6i/0.2i+h+e+o0/1i&#39;</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="s1">&#39;af&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;my-figure.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Arguments can also be passed as in the GMT command-line by using a single
string:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gmt</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">gmt</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<span class="n">gmt</span><span class="o">.</span><span class="n">makecpt</span><span class="p">(</span><span class="s1">&#39;-Ccubhelix -T-4500/4500&#39;</span><span class="p">,</span> <span class="n">output</span><span class="o">=</span><span class="s1">&#39;my.cpt&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">grdimage</span><span class="p">(</span><span class="s1">&#39;grid.nc -JM6i -Baf -P -Cmy.cpt&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">colorbar</span><span class="p">(</span><span class="s1">&#39;-Cmy.cpt -DjTC+w6i/0.2i+h+e+o0/1i -Baf&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;my-figure.pdf&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Notice that output that would be redirected to a file is specified using the
<code class="docutils literal notranslate"><span class="pre">output</span></code> keyword argument.</p>
<p>You can also pass in data from Python.
Grids in netCDF format are passed as xarray <code class="docutils literal notranslate"><span class="pre">Datasets</span></code> that can come from a
netCDF file or generated in memory:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">gmt</span>
<span class="kn">import</span> <span class="nn">xarray</span> <span class="k">as</span> <span class="nn">xr</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">xr</span><span class="o">.</span><span class="n">open_dataset</span><span class="p">(</span><span class="s1">&#39;grid.nc&#39;</span><span class="p">)</span>

<span class="n">cpt</span> <span class="o">=</span> <span class="n">gmt</span><span class="o">.</span><span class="n">makecpt</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="s1">&#39;cubhelix&#39;</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="s1">&#39;-4500/4500&#39;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">gmt</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">grdimage</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="s1">&#39;M6i&#39;</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="s1">&#39;af&#39;</span><span class="p">,</span> <span class="n">P</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">cpt</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;my-figure.pdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>Tabular data can be passed as numpy arrays:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">gmt</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;data_file.csv&#39;</span><span class="p">)</span>

<span class="n">cpt</span> <span class="o">=</span> <span class="n">gmt</span><span class="o">.</span><span class="n">makecpt</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="s2">&quot;red,green,blue&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="s2">&quot;0,70,300,10000&quot;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">gmt</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">coast</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="s1">&#39;N180/10i&#39;</span><span class="p">,</span> <span class="n">G</span><span class="o">=</span><span class="s1">&#39;bisque&#39;</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="s1">&#39;azure1&#39;</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="s1">&#39;af&#39;</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="s1">&#39;ci&#39;</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">cpt</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="s1">&#39;i1&#39;</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="s1">&#39;2,1,3,4+s0.02&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;my-figure.pdf&#39;</span><span class="p">)</span>
</pre></div>
</div>
<p>In the Jupyter notebook, we can preview the plot by calling <code class="docutils literal notranslate"><span class="pre">gmt.show()</span></code>,
which embeds the image in the notebook:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">import</span> <span class="nn">gmt</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">loadtxt</span><span class="p">(</span><span class="s1">&#39;data_file.csv&#39;</span><span class="p">)</span>

<span class="n">cpt</span> <span class="o">=</span> <span class="n">gmt</span><span class="o">.</span><span class="n">makecpt</span><span class="p">(</span><span class="n">C</span><span class="o">=</span><span class="s2">&quot;red,green,blue&quot;</span><span class="p">,</span> <span class="n">T</span><span class="o">=</span><span class="s2">&quot;0,70,300,10000&quot;</span><span class="p">)</span>
<span class="n">fig</span> <span class="o">=</span> <span class="n">gmt</span><span class="o">.</span><span class="n">Figure</span><span class="p">()</span>
<span class="n">fig</span><span class="o">.</span><span class="n">coast</span><span class="p">(</span><span class="n">R</span><span class="o">=</span><span class="s1">&#39;g&#39;</span><span class="p">,</span> <span class="n">J</span><span class="o">=</span><span class="s1">&#39;N180/10i&#39;</span><span class="p">,</span> <span class="n">G</span><span class="o">=</span><span class="s1">&#39;bisque&#39;</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="s1">&#39;azure1&#39;</span><span class="p">,</span> <span class="n">B</span><span class="o">=</span><span class="s1">&#39;af&#39;</span><span class="p">,</span> <span class="n">X</span><span class="o">=</span><span class="s1">&#39;c&#39;</span><span class="p">)</span>
<span class="n">fig</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="nb">input</span><span class="o">=</span><span class="n">data</span><span class="p">,</span> <span class="n">S</span><span class="o">=</span><span class="s1">&#39;ci&#39;</span><span class="p">,</span> <span class="n">C</span><span class="o">=</span><span class="n">cpt</span><span class="p">,</span> <span class="n">h</span><span class="o">=</span><span class="s1">&#39;i1&#39;</span><span class="p">,</span> <span class="n">i</span><span class="o">=</span><span class="s1">&#39;2,1,3,4+s0.02&#39;</span><span class="p">)</span>
<span class="n">gmt</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>
</pre></div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">gmt.show</span></code> will call <code class="docutils literal notranslate"><span class="pre">psconvert</span></code> in the background to get a PNG image back
and use <code class="docutils literal notranslate"><span class="pre">IPython.display.Image</span></code> to insert it into the notebook.</p>
<p><strong>TODO</strong>: We’re still thinking of the best way to call <code class="docutils literal notranslate"><span class="pre">gmt.psconvert</span></code> first
to generate a high-quality PDF and right after call <code class="docutils literal notranslate"><span class="pre">gmt.show()</span></code> for an
inline preview.
The issue is that <code class="docutils literal notranslate"><span class="pre">psconvert</span></code> deletes the temporary Postscript file that was
being constructed on the background, this calling it a second time through
<code class="docutils literal notranslate"><span class="pre">gmt.show()</span></code> would not work.
Any suggestions are welcome!</p>
</div>
<div class="section" id="package-organization">
<h2>Package organization<a class="headerlink" href="#package-organization" title="Permalink to this headline">¶</a></h2>
<p>The general layout of the Python package will probably look something like
this:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">gmt</span><span class="o">/</span>
    <span class="n">clib</span><span class="o">/</span>     <span class="c1"># Package with low-level wrappers for the C API</span>
        <span class="o">...</span>
    <span class="n">modules</span><span class="o">/</span>  <span class="c1"># Defines the functions corresponding to GMT modules</span>
        <span class="o">...</span>
</pre></div>
</div>
</div>
<div class="section" id="the-module-functions">
<h2>The module functions<a class="headerlink" href="#the-module-functions" title="Permalink to this headline">¶</a></h2>
<p>The functions corresponding to GMT modules (<code class="docutils literal notranslate"><span class="pre">pscoast</span></code>, <code class="docutils literal notranslate"><span class="pre">psconvert</span></code>, etc)
are how the user interacts with the Python API.
They will be organized in different files in the <code class="docutils literal notranslate"><span class="pre">gmt.modules</span></code> package but
will all be accessible from the <code class="docutils literal notranslate"><span class="pre">gmt</span></code> package namespace.
For example, <code class="docutils literal notranslate"><span class="pre">pscoast</span></code> can live in <code class="docutils literal notranslate"><span class="pre">gmt/modules/ps_generating.py</span></code> but can
be called as <code class="docutils literal notranslate"><span class="pre">gmt.pscoast</span></code>.</p>
<p>Here is what a module function will look like:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">module_function</span><span class="p">(</span><span class="o">**</span><span class="n">kwargs</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Docstring explaining what each option is and all the aliases.</span>

<span class="sd">    Likely derived from the GMT documentation.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert any inputs into things the C API can digest</span>
    <span class="o">...</span>
    <span class="c1"># Parse the keyword arguments and make an &quot;args&quot; list</span>
    <span class="o">...</span>
    <span class="c1"># Call the module function from the C API with the inputs</span>
    <span class="o">...</span>
    <span class="c1"># Process any outputs from the C API into Python data types</span>
    <span class="o">...</span>
    <span class="k">return</span> <span class="n">output</span>
</pre></div>
</div>
<p>We will automate this process as much as possible:</p>
<ul class="simple">
<li>Common options in the docstrings can be reused from an <code class="docutils literal notranslate"><span class="pre">OPTIONS</span></code>
dictionary.</li>
<li>Parsing of common arguments (R, J, etc) can be done by a function.</li>
<li>Creating the GMT session and calling the module can be automated.</li>
<li>Conversion of inputs and outputs will most likely be: tables to numpy arrays,
grids to xarray <code class="docutils literal notranslate"><span class="pre">Datasets</span></code>, text to Python text.</li>
</ul>
<p>Most of the work in this part will be wrapping all of the many GMT modules,
parsing non-standard options, and making sure the docstrings are accurate.
It might even be possible to automatically generate the docstrings or parts of
them from the command-line help messages by passing a Python callback as the
<code class="docutils literal notranslate"><span class="pre">print_func</span></code> when creating a GMT session.</p>
</div>
<div class="section" id="the-low-level-wrappers">
<h2>The low-level wrappers<a class="headerlink" href="#the-low-level-wrappers" title="Permalink to this headline">¶</a></h2>
<p>The low-level wrapper functions will be bare-bones <a class="reference external" href="https://docs.python.org/3/library/ctypes.html#module-ctypes" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ctypes</span></code></a> foreign
functions from the <code class="docutils literal notranslate"><span class="pre">libgmt.so</span></code> shared library.
The functions can be accessed from Python like so:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">ctypes</span> <span class="k">as</span> <span class="nn">ct</span>

<span class="n">libgmt</span> <span class="o">=</span> <span class="n">ct</span><span class="o">.</span><span class="n">cdll</span><span class="o">.</span><span class="n">LoadLibrary</span><span class="p">(</span><span class="s2">&quot;libgmt.so&quot;</span><span class="p">)</span>

<span class="c1"># Functions are accessed as members of the &#39;libgmt&#39; object</span>
<span class="n">GMT_Call_Module</span> <span class="o">=</span> <span class="n">libgmt</span><span class="o">.</span><span class="n">GMT_Call_Module</span>

<span class="c1"># Call them like normal Python functions</span>
<span class="n">GMT_Call_Module</span><span class="p">(</span><span class="o">...</span> <span class="n">inputs</span> <span class="o">...</span><span class="p">)</span>
</pre></div>
</div>
<p>The tricky part is making sure the functions get the input types they need.
<a class="reference external" href="https://docs.python.org/3/library/ctypes.html#module-ctypes" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ctypes</span></code></a> provides access to C data types and a way to specify the data
type conversions that the function requires:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GMT_Call_Module</span><span class="o">.</span><span class="n">argstypes</span> <span class="o">=</span> <span class="p">[</span><span class="n">ct</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">,</span> <span class="n">ct</span><span class="o">.</span><span class="n">c_char_p</span><span class="p">,</span> <span class="n">ct</span><span class="o">.</span><span class="n">c_int</span><span class="p">,</span> <span class="n">ct</span><span class="o">.</span><span class="n">c_void_p</span><span class="p">]</span>
</pre></div>
</div>
<p>This is fine for standard data types like <code class="docutils literal notranslate"><span class="pre">int</span></code>, <code class="docutils literal notranslate"><span class="pre">char</span></code>, etc, but will need
extra work for custom GMT <code class="docutils literal notranslate"><span class="pre">struct</span></code>.
These data types will need to be wrapped by Python classes that inherit from
<a class="reference external" href="https://docs.python.org/3/library/ctypes.html#ctypes.Structure" title="(in Python v3.7)"><code class="xref py py-class docutils literal notranslate"><span class="pre">ctypes.Structure</span></code></a>.</p>
<p>The <code class="docutils literal notranslate"><span class="pre">gmt.c_api</span></code> module will expose these foreign functions (with output and
input types specified) and GMT data types for the modules to use.</p>
<p>The main entry point into GMT will be through the <code class="docutils literal notranslate"><span class="pre">GMT_Call_Module</span></code> function.
This is what the <code class="docutils literal notranslate"><span class="pre">gmt</span></code> command-line application uses to run a given
module, like <code class="docutils literal notranslate"><span class="pre">GMT_pscoast</span></code> for example.
We will use it to run the modules from the Python side as well.
It has the following signature:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="nb">int</span> <span class="n">GMT_Call_Module</span> <span class="p">(</span><span class="n">void</span> <span class="o">*</span><span class="n">V_API</span><span class="p">,</span> <span class="n">const</span> <span class="n">char</span> <span class="o">*</span><span class="n">module</span><span class="p">,</span> <span class="nb">int</span> <span class="n">mode</span><span class="p">,</span> <span class="n">void</span> <span class="o">*</span><span class="n">args</span><span class="p">)</span>
</pre></div>
</div>
<p>The arguments <code class="docutils literal notranslate"><span class="pre">module</span></code>, <code class="docutils literal notranslate"><span class="pre">mode</span></code>, and <code class="docutils literal notranslate"><span class="pre">args</span></code> (the command-line argument
list) are plain C types and can be generated easily using <a class="reference external" href="https://docs.python.org/3/library/ctypes.html#module-ctypes" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ctypes</span></code></a>.
The Python module code will need to generate the <code class="docutils literal notranslate"><span class="pre">args</span></code> array from the
given function arguments.
The <code class="docutils literal notranslate"><span class="pre">V_API</span></code> argument is a “GMT Session” and is created through the
<code class="docutils literal notranslate"><span class="pre">GMT_Create_Session</span></code> function, which will have to be wrapped as well.</p>
<p>The input and output of Python data will be handled through the GMT virtual
file machinery.
This allows us to write data to a memory location instead of a file without GMT
knowing the difference.
For input, we can use <code class="docutils literal notranslate"><span class="pre">GMT_Open_VirtualFile</span></code> and point it to the location in
memory of the Python data, for example using <a class="reference external" href="https://docs.scipy.org/doc/numpy/reference/generated/numpy.ndarray.ctypes.html#numpy.ndarray.ctypes" title="(in NumPy v1.15)"><code class="xref py py-attr docutils literal notranslate"><span class="pre">numpy.ndarray.ctypes</span></code></a>.
We can also translate the Python data into <a class="reference external" href="https://docs.python.org/3/library/ctypes.html#module-ctypes" title="(in Python v3.7)"><code class="xref py py-mod docutils literal notranslate"><span class="pre">ctypes</span></code></a> compatible types.
The virtual file pointer can also be passed as the output option for the
module, for example as <code class="docutils literal notranslate"><span class="pre">-G</span></code> or through redirection (<code class="docutils literal notranslate"><span class="pre">-&gt;</span></code>).
We can read the contents of the virtual file using <code class="docutils literal notranslate"><span class="pre">GMT_Read_VirtualFile</span></code>.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
      
        <a href="sphinxext.html" class="btn btn-neutral" title="Sphinx Extension" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2017-2018, Leonardo Uieda and Paul Wessel.
      Last updated on Sep 27, 2018.

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  

    <script type="text/javascript">
        var DOCUMENTATION_OPTIONS = {
            URL_ROOT:'./',
            VERSION:'',
            LANGUAGE:'None',
            COLLAPSE_INDEX:false,
            FILE_SUFFIX:'.html',
            HAS_SOURCE:  true,
            SOURCELINK_SUFFIX: '.txt'
        };
    </script>
      <script type="text/javascript" src="_static/jquery.js"></script>
      <script type="text/javascript" src="_static/underscore.js"></script>
      <script type="text/javascript" src="_static/doctools.js"></script>
      <script type="text/javascript" src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.1/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>

  

  <script type="text/javascript" src="_static/js/theme.js"></script>

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>